# author: Rochus Keller (me@rochus-keller.ch)
# License: GPL
# https://github.com/rochus-keller/BUSY/blob/main/README.md on how to use this file

# NOTE: This is still for the old AoNavigator. The newer BUSY build is pending.

if busy_version < "2023-01-15" {
    error("this version of BUSY is not compatible with this build")
}

let mtconf : Config {
    .cflags = [ "/O2", "/MT" ]
}

if (build_mode == `optimized) && (target_toolchain == `msvc) {
    set_defaults(target_toolchain,mtconf)
}

submod qtcore = ../LeanQt (HAVE_COREAPP,HAVE_FILEIO)

let run_moc : Moc {
    .sources += [
    ]
}

let o2c_conf : Config {
    .include_dirs += [ . .. ]
}

let aofront : SourceSet {
    .configs += [ qtcore.qt_client_config o2c_conf ]
    .sources += [
        ./AoBuilins.cpp
        ./AoRowCol.cpp
        ./AoToken.cpp
        ./AoLexer.cpp
        ./AoTokenType.cpp
        ./AoParser2.cpp
        ./AoAst.cpp
        ./AoValidator2.cpp
    ]
}

let aoback : SourceSet {
    .configs += [ qtcore.qt_client_config o2c_conf ]
    .sources += [
        ./AoCeeGen.cpp
        ./AoClosureLifter.cpp
    ]
}

let o2c ! : Executable {
    .configs += [ qtcore.qt_client_config o2c_conf ]
    .sources = [
        ./Ao2C.cpp
        ./AoProject2.cpp
    ]
    .deps += [ qtcore.libqt aofront aoback ]
    if target_os == `win32 {
        .deps += qtcore.libqtwinmain
    }
}


